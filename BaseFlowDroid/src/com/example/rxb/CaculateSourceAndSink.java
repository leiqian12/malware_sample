package com.example.rxb;

import java.io.IOException;
import java.util.HashSet;
import java.util.LinkedList;
import java.util.List;
import java.util.Set;



import soot.jimple.infoflow.android.data.AndroidMethod;
import soot.jimple.infoflow.android.data.parsers.PermissionMethodParser;

public class CaculateSourceAndSink {

public static  List<String> calculateSourcesSinksEntrypoints
(String sourceSinkFile) throws IOException{
PermissionMethodParser parser = PermissionMethodParser.fromFile(sourceSinkFile);
List<String> sourcesAndSinks = new LinkedList<String>();
Set<String> sourceString = new HashSet<String>();
Set<String> sinkString = new HashSet<String>();
for (AndroidMethod am : parser.parse()){
	if (am.isSource())
	{
		sourceString.add(am.toString());
//		sources.add(am);
	}
	if(am.isSink())
		sinkString.add(am.toString());
//		sinks.add(am);
}
for(String str:sourceString){
	String[] strArray=str.substring(str.indexOf("<")+1, str.indexOf(")>")).replace(": "," ").split(" ");
if(!sourcesAndSinks.contains(strArray[0]+"->"+strArray[2].substring(0, strArray[2].indexOf("("))))
	sourcesAndSinks.add(strArray[0]+"->"+strArray[2].substring(0, strArray[2].indexOf("(")));
}
for(String str:sinkString){
	String[] strArray=str.substring(str.indexOf("<")+1, str.indexOf(")>")).replace(": "," ").split(" ");
	if(!sourcesAndSinks.contains(strArray[0]+"->"+strArray[2].substring(0, strArray[2].indexOf("("))))
		sourcesAndSinks.add(strArray[0]+"->"+strArray[2].substring(0, strArray[2].indexOf("(")));
}
for(String str:sourcesAndSinks){
	str.trim();
}
return sourcesAndSinks;
}
	public static void main(final String[] args) throws IOException{
//		calculateSourcesSinksEntrypoints("E:\\period\\我的研一\\伊阳贵毕业设计\\soot-infoflow-android-develop\\SourcesAndSinks.txt");
System.out.println(calculateSourcesSinksEntrypoints("I:\\SourcesAndSinks.txt"));
	}
}
